/* Global Theme Overrides - Root-Only Strategy */

:root {
    /* Font Scale - Applied globally to affect ALL text */
    font-size: calc(16px * var(--nt-font-scale, 1));

    /* 1. Variable Mapping (Priority 1) */
    /* Map Quasar variables to NiceTheme tokens in the root scope */

    /* Scaling */
    --q-size-scale: var(--nt-font-scale, 1);

    /* Core Colors */
    --q-primary: var(--nt-primary) !important;
    --q-secondary: var(--nt-secondary) !important;
    --q-accent: var(--nt-content-accent) !important;
    --q-positive: var(--nt-positive) !important;
    --q-negative: var(--nt-negative) !important;
    --q-info: var(--nt-info) !important;
    --q-warning: var(--nt-warning) !important;

    /* Theme States (Dark Mode) */
    /* Page background (darkest) vs Component background (lighter) */
    /* Page Background */
    --q-dark-page: var(--nt-surface-page) !important;

    /* Separators */
    --q-separator-color: var(--nt-border-color) !important;
}

/* Shadow Helpers Overrides */
/* Force Quasar's shadow-1 to shadow-24 to use the theme shadow RGB */
[class*="shadow-"] {
    box-shadow: 0 1px 5px rgba(var(--nt-shadow-rgb), calc(0.2 * var(--nt-shadow-intensity, 1))), 0 2px 2px rgba(var(--nt-shadow-rgb), calc(0.14 * var(--nt-shadow-intensity, 1))), 0 3px 1px -2px rgba(var(--nt-shadow-rgb), calc(0.12 * var(--nt-shadow-intensity, 1))) !important;
}

/* 2. Generic Class Injection (Priority 2) */
/* Grouped overrides for properties without direct Quasar variable equivalents */

/* Typography */
body,
.q-tooltip {
    font-family: var(--nt-font-secondary), Roboto, -apple-system, Helvetica, Arial, sans-serif !important;
    color: var(--nt-content-0) !important;
    background-color: var(--nt-surface-page) !important;
}

h1,
h2,
h3,
h4,
h5,
h6,
.text-h1,
.text-h2,
.text-h3,
.text-h4,
.text-h5,
.text-h6,
.q-toolbar__title,
.text-2xl,
.text-3xl,
.text-4xl,
.text-5xl,
.text-6xl,
.text-7xl {
    font-family: var(--nt-font-primary), sans-serif !important;
}

/* Monospace Font - Apply to inputs, code, and data displays */
input,
textarea,
code,
pre,
.q-field__native,
.q-input input,
.q-textarea textarea,
.monospace,
.font-mono,
kbd,
samp,
var {
    font-family: var(--nt-font-mono), 'Courier New', Consolas, monospace !important;
}

/* Text Transform (Titles, Buttons, etc) */
.q-btn,
.q-tab__label,
.q-badge,
h1,
h2,
h3,
h4,
h5,
h6,
.text-h1,
.text-h2,
.text-h3,
.text-h4,
.text-h5,
.text-h6,
.text-2xl,
.text-3xl,
.text-4xl,
.text-5xl,
.text-6xl,
.text-7xl {
    text-transform: var(--nt-text-transform-title, none) !important;
}

/* Exception: Theme Config Toggle Options */
.nt-case-toggle .q-btn {
    text-transform: none !important;
}

/* Roundness */
/* Apply to all container-like or button-like elements */
.q-btn,
.q-card,
.q-field__control,
.q-dialog__inner>div,
.q-menu,
.q-badge,
.q-date,
.q-time,
.q-color-picker,
.q-tab-panel,
.q-splitter,
.q-stepper,
.q-table,
.q-table__container,
.q-tooltip,
.q-notification,
.q-expansion-item,
.q-panel,
.q-toggle__track {
    border-radius: calc(var(--nt-roundness, 4) * 1px) !important;
}

/* Borders */
/* Generic Utility Overrides for theme consistency */
.border,
.border-t,
.border-b,
.border-l,
.border-r,
.q-card--bordered,
.q-btn--outline,
.q-btn--bordered,
.q-field--outlined .q-field__control,
.q-table__container,
.q-table__bottom,
.q-stepper--bordered,
.q-expansion-item--bordered {
    border-width: 0;
    /* Clear default */
    border-style: solid;
    border-color: var(--nt-border-color) !important;
}

.border,
.q-card--bordered,
.q-btn--outline,
.q-btn--bordered,
.q-field--outlined .q-field__control,
.q-table__container,
.q-stepper--bordered,
.q-expansion-item--bordered {
    border-width: calc(var(--nt-border-width, 1) * 1px) !important;
}

.border-t {
    border-top-width: calc(var(--nt-border-width, 1) * 1px) !important;
}

.border-b {
    border-bottom-width: calc(var(--nt-border-width, 1) * 1px) !important;
}

.border-l {
    border-left-width: calc(var(--nt-border-width, 1) * 1px) !important;
}

.border-r {
    border-right-width: calc(var(--nt-border-width, 1) * 1px) !important;
}

/* Special case: Separators */
.q-separator,
.q-field--standard .q-field__control:before {
    background-color: var(--nt-border-color) !important;
    height: calc(var(--nt-border-width, 1) * 1px) !important;
    border: none !important;
}

/* Vertical Separator */
.q-separator--vertical {
    width: calc(var(--nt-border-width, 1) * 1px) !important;
    height: auto !important;
}

/* Splitters */
/* The separator itself should be thin, but we'll add a generous ::before pseudo-element for the drag area */
.q-splitter__separator {
    position: relative !important;
    background-color: transparent !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    overflow: visible !important;
}

.q-splitter__separator-area {
    cursor: col-resize !important;
}

.q-splitter--vertical>.q-splitter__separator .q-splitter__separator-area {
    cursor: row-resize !important;
}

/* Generous invisible drag area */
.q-splitter__separator:before {
    content: '';
    position: absolute !important;
    z-index: 1 !important;
    pointer-events: auto !important;
}

/* Visual pill handle */
.q-splitter__separator:after {
    content: '';
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    background-color: rgba(var(--nt-content-rgb), 0.2) !important;
    border-radius: 99px !important;
    transition: background-color 0.2s, transform 0.2s;
    pointer-events: none !important;
    z-index: 2 !important;
}

.q-splitter__separator:hover:after {
    background-color: rgba(var(--nt-content-rgb), 0.5) !important;
    transform: translate(-50%, -50%) scale(1.1) !important;
}

/* HORIZONTAL splitter = side-by-side panels = VERTICAL separator bar */
.q-splitter--horizontal>.q-splitter__separator {
    width: 1px !important;
    min-width: 1px !important;
}

/* Drag area for horizontal splitter (vertical bar) */
.q-splitter--horizontal>.q-splitter__separator:before {
    width: 24px !important;
    height: 100% !important;
    top: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
}

/* Visual handle for horizontal splitter (vertical pill) */
.q-splitter--horizontal>.q-splitter__separator:after {
    width: 4px !important;
    height: 48px !important;
}

/* VERTICAL splitter = stacked panels = HORIZONTAL separator bar */
.q-splitter--vertical>.q-splitter__separator {
    height: 1px !important;
    min-height: 1px !important;
}

/* Drag area for vertical splitter (horizontal bar) */
.q-splitter--vertical>.q-splitter__separator:before {
    width: 100% !important;
    height: 24px !important;
    left: 0 !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
}

/* Visual handle for vertical splitter (horizontal pill) */
.q-splitter--vertical>.q-splitter__separator:after {
    height: 4px !important;
    width: 48px !important;
}

/* Texture (Surface, Opacity, Blur, Shadows) */
/* Apply to floating/container elements */
.q-card,
.q-menu,
.q-dialog__inner>div,
.q-tooltip,
.q-popup-edit {
    /* Background with opacity */
    background-color: rgba(var(--nt-surface-rgb, 255, 255, 255), var(--nt-opacity, 1)) !important;

    /* Blur effect */
    backdrop-filter: blur(calc(1px * var(--nt-blur, 0))) !important;

    /* Shadows */
    box-shadow: 0 4px 6px -1px rgba(var(--nt-shadow-rgb), calc(0.1 * var(--nt-shadow-intensity, 1))),
        0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.06 * var(--nt-shadow-intensity, 1))) !important;
}

/* Density (Gaps) */
.row.gap-4,
.column.gap-4,
.q-gutter-md {
    gap: calc(16px * var(--nt-density, 1)) !important;
}

.row.gap-2,
.column.gap-2,
.q-gutter-sm {
    gap: calc(8px * var(--nt-density, 1)) !important;
}

/* 3. Global Utilities & Specific Components */

/* Scrollbars */
::-webkit-scrollbar {
    width: 12px;
    background-color: rgba(var(--nt-surface-rgb), 0.5);
}

::-webkit-scrollbar-thumb {
    background-color: rgba(var(--nt-content-rgb), 0.2);
    border-radius: 99px;
}

/* Theme Utilities (White/Black overrides) */
html body .text-white,
html body .q-btn.text-white {
    color: var(--nt-color-white) !important;
}

html body .bg-white {
    background-color: var(--nt-color-white) !important;
}

html body .text-black,
html body .q-btn.text-black {
    color: var(--nt-color-black) !important;
}

html body .bg-black {
    background-color: var(--nt-color-black) !important;
}

/* Component Specifics */
.nt-palette-indicator {
    background-color: rgba(var(--nt-surface-rgb), 0.9) !important;
    border: 1px solid rgba(var(--nt-content-rgb), 0.1) !important;
    backdrop-filter: blur(2px);
}

.nicegui-error-popup {
    background-color: var(--nt-surface-page) !important;
    color: var(--nt-content-0) !important;
    border: 1px solid var(--nt-border-color);
}

/* 4. Dark Mode Text Contrast Overrides */
/* Force content colors in dark mode for elements that default to black/dark grey */
body.body--dark .q-field__label,
body.body--dark .q-item__label,
body.body--dark .text-caption,
body.body--dark .text-grey,
body.body--dark .q-input,
body.body--dark .q-select__dropdown-icon,
body.body--dark .q-field__native,
body.body--dark .q-field__prefix,
body.body--dark .q-field__suffix,
body.body--dark .q-btn__content,
body.body--dark .q-tab__label,
body.body--dark .text-xs,
body.body--dark .nt-tab-label {
    color: var(--nt-content-0) !important;
    opacity: 1 !important;
    /* Fix opacity-60 issues */
}

/* Specific fix for low contrast opacity elements */
body.body--dark .opacity-60 {
    opacity: 0.8 !important;
    color: var(--nt-content-0) !important;
}

/* 5. Generic Text Dark Mode Fix */
/* Quasar's .q-dark class sets color: #fff on #app or q-layout, which we want to be our theme content color */
body.body--dark .q-layout,
body.body--dark .q-page-container,
body.body--dark #app.q-dark {
    color: var(--nt-content-0) !important;
}

/* 6. Component Shadow Uniformity */

/* Buttons: Override pseudo-element shadow to use theme color */
/* Only apply to standard and push buttons, NOT flat or outline */
.q-btn--standard:before,
.q-btn--push:before {
    box-shadow: 0 1px 5px rgba(var(--nt-shadow-rgb), calc(0.2 * var(--nt-shadow-intensity, 1))), 0 2px 2px rgba(var(--nt-shadow-rgb), calc(0.14 * var(--nt-shadow-intensity, 1))), 0 3px 1px -2px rgba(var(--nt-shadow-rgb), calc(0.12 * var(--nt-shadow-intensity, 1))) !important;
}

/* Exception: Toggle buttons should not have shadows */
.q-btn-toggle .q-btn--standard:before {
    box-shadow: none !important;
}

/* Button Groups: Apply themed shadows */
.q-btn-group {
    box-shadow: 0 1px 5px rgba(var(--nt-shadow-rgb), calc(0.2 * var(--nt-shadow-intensity, 1))), 0 2px 2px rgba(var(--nt-shadow-rgb), calc(0.14 * var(--nt-shadow-intensity, 1))), 0 3px 1px -2px rgba(var(--nt-shadow-rgb), calc(0.12 * var(--nt-shadow-intensity, 1))) !important;
}

/* Fields/Selects: Ensure they have a subtle shadow matching the theme */
.q-field--standout .q-field__control,
.q-field--filled .q-field__control,
.q-field--outlined .q-field__control {
    /* Optional: Add shadow to inputs if design requires, usually they are flat or rely on border */
    /* For now, just ensuring any potential shadow uses the theme RGB if it exists */
    --q-color-shadow: rgba(var(--nt-shadow-rgb), 0.2);
}

/* Standard Field Underline: Handled by .q-field--standard rule above */

/* Dropdown Menus: Ensure they use the theme shadow color and correct surface depth */
/* Default Quasar menu shadow might be black; force theme RGB */
.q-menu {
    box-shadow: 0 4px 6px -1px rgba(var(--nt-shadow-rgb), calc(0.1 + 0.1 * var(--nt-shadow-intensity, 1))), 0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.06 + 0.06 * var(--nt-shadow-intensity, 1))) !important;
    background: var(--nt-surface-2) !important;
}

/* Tooltips: Use surface-2 */
.q-tooltip {
    background: var(--nt-surface-2) !important;
    color: var(--nt-content-0) !important;
    /* Ensure text is readable on surface-2 */
    font-size: 0.75rem;
}

/* Cards: Use surface-1 */
.q-card {
    background: var(--nt-surface-1) !important;
}

/* Custom Select Button Arrow */
.nt-select-button .q-icon {
    text-shadow: none !important;
    color: var(--nt-content-0) !important;
}

/* Fix generic box-shadow usage if present on these elements */
.q-btn,
.nt-select-button {
    /* Some variants might put shadow directly on element */
    --q-shadow-2: 0 1px 5px rgba(var(--nt-shadow-rgb), calc(0.2 * var(--nt-shadow-intensity, 1))), 0 2px 2px rgba(var(--nt-shadow-rgb), calc(0.14 * var(--nt-shadow-intensity, 1))), 0 3px 1px -2px rgba(var(--nt-shadow-rgb), calc(0.12 * var(--nt-shadow-intensity, 1)));
}

/* 7. Unconverted Component Fixes (Radios, Toggles, Pickers, etc.) */

/* Radios: Fix inactive border color */
.q-radio__inner {
    color: var(--nt-inactive) !important;
}

.q-radio__inner--truthy {
    color: var(--nt-primary) !important;
}

/* Toggles: Remove unwanted shadows */
.q-toggle__thumb:before {
    box-shadow: none !important;
}

.q-toggle__inner--truthy .q-toggle__thumb:before {
    /* Optional: restore a subtle shadow if needed, or keep flat as requested */
    box-shadow: 0 1px 3px rgba(var(--nt-shadow-rgb), 0.2) !important;
}

/* Date & Time Pickers: Fix backgrounds and text */
.q-date,
.q-time {
    background: var(--nt-surface-1) !important;
    color: var(--nt-content-0) !important;
    border: calc(var(--nt-border-width, 1) * 1px) solid var(--nt-border-color) !important;
}

.q-date__header,
.q-time__header {
    background-color: var(--nt-primary) !important;
    color: var(--nt-content-0-inverse, #fff) !important;
}

.q-date__calendar-item button {
    color: var(--nt-content-0) !important;
}

/* Color Picker: Fix background */
.q-color-picker {
    background: var(--nt-surface-1) !important;
    box-shadow: 0 4px 6px -1px rgba(var(--nt-shadow-rgb), calc(0.1 * var(--nt-shadow-intensity, 1))), 0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.06 * var(--nt-shadow-intensity, 1))) !important;
    border: calc(var(--nt-border-width, 1) * 1px) solid var(--nt-border-color) !important;
}

.q-color-picker__header {
    background: var(--nt-surface-2) !important;
}

/* Panels: Fix background unstyled */
.q-tab-panel {
    background: transparent !important;
    /* Should inherit from container/card */
    color: var(--nt-content-0);
}

.q-tab-panels {
    background: transparent !important;
    border: calc(var(--nt-border-width, 1) * 1px) solid var(--nt-border-color) !important;
}

/* Stepper: Fix background */
.q-stepper {
    background: var(--nt-surface-1) !important;
    color: var(--nt-content-0) !important;
    border: calc(var(--nt-border-width, 1) * 1px) solid var(--nt-border-color) !important;
    box-shadow: 0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.1 * var(--nt-shadow-intensity, 1))), 0 1px 2px -1px rgba(var(--nt-shadow-rgb), calc(0.06 * var(--nt-shadow-intensity, 1))) !important;
}

.q-stepper__step-inner {
    color: var(--nt-content-0);
}

.q-stepper--bordered {
    border: 1px solid var(--nt-border-color) !important;
}

/* Table: Fix background and text */
.q-table__container {
    background: var(--nt-surface-1) !important;
    color: var(--nt-content-0) !important;
    border: calc(var(--nt-border-width, 1) * 1px) solid var(--nt-border-color) !important;
    box-shadow: 0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.1 * var(--nt-shadow-intensity, 1))), 0 1px 2px -1px rgba(var(--nt-shadow-rgb), calc(0.06 * var(--nt-shadow-intensity, 1))) !important;
}

.q-table {
    color: var(--nt-content-0) !important;
}

.q-table th {
    color: var(--nt-content-1) !important;
    /* Slightly muted header */
    opacity: 0.8;
}

.q-table__bottom {
    border-top: 1px solid var(--nt-border-color) !important;
    background: var(--nt-surface-1) !important;
    color: var(--nt-content-0);
}

/* Tree: Fix text styling */
.q-tree {
    color: var(--nt-content-0) !important;
}

.q-tree__node-header-content {
    color: var(--nt-content-0);
}

.q-tree__icon {
    color: var(--nt-content-1) !important;
}

/* Notifications: Apply shadow intensity */
.q-notification {
    box-shadow: 0 4px 6px -1px rgba(var(--nt-shadow-rgb), calc(0.1 * var(--nt-shadow-intensity, 1))), 0 2px 4px -1px rgba(var(--nt-shadow-rgb), calc(0.06 * var(--nt-shadow-intensity, 1))) !important;
}